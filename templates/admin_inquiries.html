<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Inquiries - Admin Panel</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f8fafc;
            color: #334155;
            line-height: 1.6;
        }

        /* Header */
        header {
            background: #ffffff;
            color: #0f172a;
            padding: 1.5rem 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid #e2e8f0;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            color: #0f172a;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        header h1 i {
            color: #3b82f6;
            font-size: 1.5rem;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 18px;
            background: #f1f5f9;
            color: #475569;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-family: 'Inter', sans-serif;
        }

        .btn:hover {
            background: #e2e8f0;
            border-color: #cbd5e1;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #fef2f2;
            color: #dc2626;
            border-color: #fecaca;
        }

        .btn-danger:hover {
            background: #fee2e2;
            border-color: #fca5a5;
        }

        .btn-success {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }

        .btn-success:hover {
            background: #059669;
            border-color: #059669;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .btn-primary:hover {
            background: #2563eb;
            border-color: #2563eb;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, #3b82f6, #8b5cf6);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            border-color: #cbd5e1;
        }

        .stat-card-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .stat-info h3 {
            font-size: 2.25rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 4px;
        }

        .stat-info p {
            color: #64748b;
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            color: #3b82f6;
        }

        /* Filters */
        .filters {
            background: white;
            padding: 24px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 24px;
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .filter-group label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 5px;
            font-weight: 600;
            display: block;
        }

        .filter-group input,
        .filter-group select {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.875rem;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s ease;
            background: #f8fafc;
        }

        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: #3b82f6;
            background: white;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .filter-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Table */
        .table-container {
            background: white;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }

        thead {
            background: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
        }

        th {
            padding: 16px 14px;
            text-align: left;
            font-weight: 600;
            font-size: 0.8rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        td {
            padding: 16px 14px;
            border-bottom: 1px solid #f1f5f9;
            font-size: 0.875rem;
            color: #334155;
        }

        tbody tr {
            transition: background 0.2s ease;
        }

        tbody tr:hover {
            background: #f8fafc;
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        .status-badge,
        .priority-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .status-new { 
            background: #fef3c7; 
            color: #92400e;
            border: 1px solid #fde68a;
        }
        .status-contacted { 
            background: #dbeafe; 
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }
        .status-quoted { 
            background: #ede9fe; 
            color: #6b21a8;
            border: 1px solid #ddd6fe;
        }
        .status-converted { 
            background: #d1fae5; 
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        .status-read { 
            background: #d1fae5; 
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .priority-high { 
            background: #fee2e2; 
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        .priority-medium { 
            background: #fed7aa; 
            color: #9a3412;
            border: 1px solid #fdba74;
        }
        .priority-low { 
            background: #e2e8f0; 
            color: #475569;
            border: 1px solid #cbd5e1;
        }

        .action-btns {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .contact-link {
            padding: 6px 12px;
            background: #10b981;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s ease;
        }

        .contact-link:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .whatsapp-link {
            background: #25D366;
        }

        .whatsapp-link:hover {
            background: #20ba5a;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 32px;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e2e8f0;
        }

        .modal-header h2 {
            color: #0f172a;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .close-modal {
            float: right;
            font-size: 28px;
            font-weight: 300;
            cursor: pointer;
            color: #94a3b8;
            line-height: 1;
            transition: color 0.2s ease;
        }

        .close-modal:hover {
            color: #334155;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #334155;
            font-size: 0.875rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.2rem;
            }

            .main-content {
                padding: 10px;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .filter-row {
                grid-template-columns: 1fr;
            }

            th, td {
                padding: 10px 5px;
                font-size: 0.85rem;
            }

            .btn {
                padding: 8px 15px;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 480px) {
            .stats {
                grid-template-columns: 1fr;
            }

            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }
        }

        /* Analytics Chart Section */
        .analytics-section {
            background: white;
            padding: 28px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 28px;
        }

        .analytics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .analytics-header h2 {
            color: #0f172a;
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .period-filter {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .period-btn {
            padding: 8px 18px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
            color: #64748b;
        }

        .period-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
            box-shadow: 0 4px 6px rgba(59, 130, 246, 0.2);
        }

        .period-btn:hover:not(.active) {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }

        .chart-container {
            position: relative;
            height: 420px;
            margin-top: 24px;
            padding: 20px;
            background: #fafbfc;
            border-radius: 8px;
        }

        @media (max-width: 768px) {
            .analytics-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .chart-container {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1><i class="fas fa-chart-line"></i> Customer Inquiries Dashboard</h1>
            <div class="header-actions">
                <a href="/admin/export-csv" class="btn btn-success"><i class="fas fa-download"></i> Export CSV</a>
                <button onclick="showBulkDelete()" class="btn btn-danger"><i class="fas fa-trash-alt"></i> Bulk Delete</button>
                <a href="/admin/logout" class="btn"><i class="fas fa-sign-out-alt"></i> Logout</a>
                <a href="/" class="btn"><i class="fas fa-home"></i> Website</a>
            </div>
        </div>
    </header>

    <div class="main-content">
        <!-- Stats -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-card-content">
                    <div class="stat-info">
                        <h3>{{ inquiries|length }}</h3>
                        <p>Total Inquiries</p>
                    </div>
                    <div class="stat-icon">
                        <i class="fas fa-inbox"></i>
                    </div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-card-content">
                    <div class="stat-info">
                        <h3>{{ inquiries|selectattr('status', 'equalto', 'new')|list|length }}</h3>
                        <p>New Inquiries</p>
                    </div>
                    <div class="stat-icon" style="background: linear-gradient(135deg, #fef3c7, #fde68a); color: #92400e;">
                        <i class="fas fa-bell"></i>
                    </div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-card-content">
                    <div class="stat-info">
                        <h3>{{ inquiries|selectattr('priority', 'equalto', 'high')|list|length }}</h3>
                        <p>High Priority</p>
                    </div>
                    <div class="stat-icon" style="background: linear-gradient(135deg, #fee2e2, #fecaca); color: #991b1b;">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-card-content">
                    <div class="stat-info">
                        <h3>{{ (inquiries|selectattr('timestamp', 'defined')|list|length) }}</h3>
                        <p>This Week</p>
                    </div>
                    <div class="stat-icon" style="background: linear-gradient(135deg, #d1fae5, #a7f3d0); color: #065f46;">
                        <i class="fas fa-calendar-week"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Chart Section -->
        <div class="analytics-section">
            <div class="analytics-header">
                <h2><i class="fas fa-chart-bar"></i> Service Inquiry Analytics</h2>
                <div class="period-filter">
                    <button class="period-btn active" data-period="weekly" onclick="updateChart('weekly')"><i class="fas fa-calendar-day"></i> Weekly</button>
                    <button class="period-btn" data-period="monthly" onclick="updateChart('monthly')"><i class="fas fa-calendar-alt"></i> Monthly</button>
                    <button class="period-btn" data-period="yearly" onclick="updateChart('yearly')"><i class="fas fa-calendar"></i> Yearly</button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="analyticsChart"></canvas>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters">
            <form method="GET">
                <div class="filter-row">
                    <div class="filter-group">
                        <label><i class="fas fa-search"></i> Search</label>
                        <input type="text" name="search" placeholder="Name, phone, email..." value="{{ filters.search }}">
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-calendar"></i> Date</label>
                        <select name="date">
                            <option value="all" {% if filters.date == 'all' %}selected{% endif %}>All Time</option>
                            <option value="today" {% if filters.date == 'today' %}selected{% endif %}>Today</option>
                            <option value="week" {% if filters.date == 'week' %}selected{% endif %}>This Week</option>
                            <option value="month" {% if filters.date == 'month' %}selected{% endif %}>This Month</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-tasks"></i> Status</label>
                        <select name="status">
                            <option value="all">All Status</option>
                            <option value="new" {% if filters.status == 'new' %}selected{% endif %}>New</option>
                            <option value="contacted" {% if filters.status == 'contacted' %}selected{% endif %}>Contacted</option>
                            <option value="quoted" {% if filters.status == 'quoted' %}selected{% endif %}>Quoted</option>
                            <option value="converted" {% if filters.status == 'converted' %}selected{% endif %}>Converted</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-flag"></i> Priority</label>
                        <select name="priority">
                            <option value="all">All Priority</option>
                            <option value="high" {% if filters.priority == 'high' %}selected{% endif %}>High</option>
                            <option value="medium" {% if filters.priority == 'medium' %}selected{% endif %}>Medium</option>
                            <option value="low" {% if filters.priority == 'low' %}selected{% endif %}>Low</option>
                        </select>
                    </div>
                </div>
                <div class="filter-actions">
                    <button type="submit" class="btn btn-primary"><i class="fas fa-filter"></i> Apply Filters</button>
                    <a href="/admin/inquiries" class="btn"><i class="fas fa-times"></i> Clear All</a>
                </div>
            </form>
        </div>

        <!-- Table -->
        <div class="table-container">
            {% if inquiries %}
            <table>
                <thead>
                    <tr>
                        <th><input type="checkbox" id="selectAll"></th>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Contact</th>
                        <th>Service</th>
                        <th>Message</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Priority</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for inquiry in inquiries %}
                    <tr data-id="{{ inquiry.id }}">
                        <td><input type="checkbox" class="inquiry-check" value="{{ inquiry.id }}"></td>
                        <td><strong>#{{ inquiry.id }}</strong></td>
                        <td>{{ inquiry.name }}</td>
                        <td>
                            <a href="tel:{{ inquiry.phone }}" class="contact-link"><i class="fas fa-phone"></i> {{ inquiry.phone }}</a><br>
                            <a href="https://wa.me/{{ inquiry.phone.replace('+', '').replace(' ', '') }}" target="_blank" class="contact-link whatsapp-link"><i class="fab fa-whatsapp"></i> WhatsApp</a>
                        </td>
                        <td>{{ inquiry.service }}</td>
                        <td style="max-width: 250px; overflow: hidden; text-overflow: ellipsis;" title="{{ inquiry.message }}">
                            {{ inquiry.message[:50] }}{% if inquiry.message|length > 50 %}...{% endif %}
                        </td>
                        <td style="white-space: nowrap; font-size: 0.85rem;">{{ inquiry.timestamp }}</td>
                        <td>
                            <select class="status-badge status-{{ inquiry.status }}" onchange="updateStatus({{ inquiry.id }}, this.value)">
                                <option value="new" {% if inquiry.status == 'new' %}selected{% endif %}>New</option>
                                <option value="contacted" {% if inquiry.status == 'contacted' %}selected{% endif %}>Contacted</option>
                                <option value="quoted" {% if inquiry.status == 'quoted' %}selected{% endif %}>Quoted</option>
                                <option value="converted" {% if inquiry.status == 'converted' %}selected{% endif %}>Converted</option>
                            </select>
                        </td>
                        <td>
                            <select class="priority-badge priority-{{ inquiry.priority }}" onchange="updatePriority({{ inquiry.id }}, this.value)">
                                <option value="low" {% if inquiry.priority == 'low' %}selected{% endif %}>Low</option>
                                <option value="medium" {% if inquiry.priority == 'medium' %}selected{% endif %}>Medium</option>
                                <option value="high" {% if inquiry.priority == 'high' %}selected{% endif %}>High</option>
                            </select>
                        </td>
                        <td>
                            <div class="action-btns">
                                <button class="btn btn-sm btn-primary" onclick="showNoteModal({{ inquiry.id }})"><i class="fas fa-sticky-note"></i> Note</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteInquiry({{ inquiry.id }})"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty-state">
                <h2><i class="fas fa-inbox" style="font-size: 3rem; color: #cbd5e1; margin-bottom: 16px;"></i></h2>
                <h3 style="color: #64748b; font-weight: 600; margin-bottom: 8px;">No Inquiries Found</h3>
                <p style="color: #94a3b8;">No inquiries match your current filters.</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Note Modal -->
    <div id="noteModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('noteModal')">&times;</span>
            <div class="modal-header">
                <h2>Add Note</h2>
            </div>
            <div class="form-group">
                <label>Note</label>
                <textarea id="noteText" placeholder="Enter your note..."></textarea>
            </div>
            <button class="btn btn-success" onclick="saveNote()">Save Note</button>
        </div>
    </div>

    <script>
        let currentInquiryId = null;

        // Select all checkboxes
        document.getElementById('selectAll').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('.inquiry-check');
            checkboxes.forEach(cb => cb.checked = this.checked);
        });

        // Update Status
        async function updateStatus(id, status) {
            try {
                const response = await fetch(`/admin/update-status/${id}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({status: status})
                });
                if (response.ok) {
                    showToast('Status updated successfully');
                }
            } catch (error) {
                showToast('Error updating status', 'error');
            }
        }

        // Update Priority
        async function updatePriority(id, priority) {
            try {
                const response = await fetch(`/admin/update-priority/${id}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({priority: priority})
                });
                if (response.ok) {
                    showToast('Priority updated successfully');
                }
            } catch (error) {
                showToast('Error updating priority', 'error');
            }
        }

        // Show Note Modal
        function showNoteModal(id) {
            currentInquiryId = id;
            document.getElementById('noteModal').style.display = 'block';
            document.getElementById('noteText').value = '';
        }

        // Close Modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Save Note
        async function saveNote() {
            const note = document.getElementById('noteText').value;
            if (!note.trim()) {
                alert('Please enter a note');
                return;
            }

            try {
                const response = await fetch(`/admin/add-note/${currentInquiryId}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({note: note})
                });
                if (response.ok) {
                    showToast('Note added successfully');
                    closeModal('noteModal');
                }
            } catch (error) {
                showToast('Error adding note', 'error');
            }
        }

        // Delete Inquiry
        async function deleteInquiry(id) {
            if (!confirm('Are you sure you want to delete this inquiry?')) return;

            try {
                const response = await fetch(`/admin/delete/${id}`, {
                    method: 'POST'
                });
                if (response.ok) {
                    document.querySelector(`tr[data-id="${id}"]`).remove();
                    showToast('Inquiry deleted');
                    location.reload();
                }
            } catch (error) {
                showToast('Error deleting inquiry', 'error');
            }
        }

        // Bulk Delete
        async function showBulkDelete() {
            const checked = Array.from(document.querySelectorAll('.inquiry-check:checked')).map(cb => parseInt(cb.value));
            if (checked.length === 0) {
                alert('Please select inquiries to delete');
                return;
            }

            if (!confirm(`Delete ${checked.length} selected inquiries?`)) return;

            try {
                const response = await fetch('/admin/bulk-delete', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ids: checked})
                });
                if (response.ok) {
                    showToast(`${checked.length} inquiries deleted`);
                    location.reload();
                }
            } catch (error) {
                showToast('Error deleting inquiries', 'error');
            }
        }

        // Toast Notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 24px;
                right: 24px;
                padding: 16px 24px;
                background: ${type === 'error' ? '#fef2f2' : '#f0fdf4'};
                color: ${type === 'error' ? '#991b1b' : '#065f46'};
                border: 1px solid ${type === 'error' ? '#fecaca' : '#bbf7d0'};
                border-radius: 12px;
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
                z-index: 10000;
                font-family: 'Inter', sans-serif;
                font-size: 0.875rem;
                font-weight: 500;
                display: flex;
                align-items: center;
                gap: 10px;
                animation: slideInRight 0.3s ease;
                max-width: 400px;
            `;
            
            const icon = type === 'error' ? '❌' : '✅';
            toast.innerHTML = `<span style="font-size: 1.2rem;">${icon}</span><span>${message}</span>`;
            
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Add animation styles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from {
                    opacity: 0;
                    transform: translateX(100px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }
            @keyframes slideOutRight {
                from {
                    opacity: 1;
                    transform: translateX(0);
                }
                to {
                    opacity: 0;
                    transform: translateX(100px);
                }
            }
        `;
        document.head.appendChild(style);

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Analytics Chart
        let analyticsChart = null;

        // Initialize chart on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadChart('weekly');
        });

        async function loadChart(period) {
            try {
                const response = await fetch(`/admin/analytics-data?period=${period}`);
                const data = await response.json();

                if (analyticsChart) {
                    analyticsChart.destroy();
                }

                const ctx = document.getElementById('analyticsChart').getContext('2d');
                analyticsChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data.services,
                        datasets: [{
                            label: 'Number of Inquiries',
                            data: data.counts,
                            backgroundColor: [
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(139, 92, 246, 0.8)',
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(245, 158, 11, 0.8)',
                                'rgba(239, 68, 68, 0.8)',
                                'rgba(236, 72, 153, 0.8)',
                                'rgba(20, 184, 166, 0.8)',
                                'rgba(99, 102, 241, 0.8)'
                            ],
                            borderColor: [
                                'rgba(59, 130, 246, 1)',
                                'rgba(139, 92, 246, 1)',
                                'rgba(16, 185, 129, 1)',
                                'rgba(245, 158, 11, 1)',
                                'rgba(239, 68, 68, 1)',
                                'rgba(236, 72, 153, 1)',
                                'rgba(20, 184, 166, 1)',
                                'rgba(99, 102, 241, 1)'
                            ],
                            borderWidth: 0,
                            borderRadius: 8,
                            barThickness: 60
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    font: {
                                        size: 13,
                                        weight: '500',
                                        family: 'Inter'
                                    },
                                    color: '#64748b',
                                    padding: 15,
                                    usePointStyle: true,
                                    pointStyle: 'circle'
                                }
                            },
                            title: {
                                display: true,
                                text: `Service Inquiries - ${period.charAt(0).toUpperCase() + period.slice(1)} Overview`,
                                font: {
                                    size: 16,
                                    weight: '600',
                                    family: 'Inter'
                                },
                                color: '#0f172a',
                                padding: { top: 10, bottom: 20 }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(15, 23, 42, 0.95)',
                                titleFont: {
                                    size: 13,
                                    weight: '600',
                                    family: 'Inter'
                                },
                                bodyFont: {
                                    size: 12,
                                    family: 'Inter'
                                },
                                padding: 12,
                                cornerRadius: 8,
                                displayColors: true,
                                borderColor: 'rgba(255, 255, 255, 0.1)',
                                borderWidth: 1
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1,
                                    font: {
                                        size: 11,
                                        family: 'Inter'
                                    },
                                    color: '#94a3b8'
                                },
                                grid: {
                                    color: 'rgba(226, 232, 240, 0.5)',
                                    drawBorder: false
                                },
                                title: {
                                    display: true,
                                    text: 'Number of Inquiries',
                                    font: {
                                        size: 12,
                                        weight: '600',
                                        family: 'Inter'
                                    },
                                    color: '#64748b'
                                }
                            },
                            x: {
                                ticks: {
                                    font: {
                                        size: 11,
                                        family: 'Inter'
                                    },
                                    color: '#94a3b8'
                                },
                                grid: {
                                    display: false
                                },
                                title: {
                                    display: true,
                                    text: 'Service Type',
                                    font: {
                                        size: 12,
                                        weight: '600',
                                        family: 'Inter'
                                    },
                                    color: '#64748b'
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error loading chart:', error);
                showToast('Error loading analytics chart', 'error');
            }
        }

        function updateChart(period) {
            // Update active button
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Load chart with new period
            loadChart(period);
        }
    </script>
</body>
</html>
